syntax = "proto3";

package common.events;

import "proto/v1/common/types.proto";

option go_package = "github.com/Marwan051/tradding_platform_game/proto/gen/go/v1/common";

// EngineEvent is the envelope for all events emitted by the matching engine.
message EngineEvent {
  string event_id = 1;
  int64 timestamp_ms = 2;
  EventType event_type = 3;

  // One of these will be set based on event_type
  OrderPlacedEvent order_placed = 10;
  OrderCancelledEvent order_cancelled = 11;
  OrderFilledEvent order_filled = 12;
  OrderPartiallyFilledEvent order_partially_filled = 13;
  OrderRejectedEvent order_rejected = 14;
  TradeExecutedEvent trade_executed = 15;
}

// EventType defines the type of event in an EngineEvent envelope.
enum EventType {
  EVENT_TYPE_UNSPECIFIED = 0;
  ORDER_PLACED = 1;
  ORDER_CANCELLED = 2;
  ORDER_FILLED = 3;
  ORDER_PARTIALLY_FILLED = 4;
  ORDER_REJECTED = 5;
  TRADE_EXECUTED = 6;
}

// OrderPlacedEvent is emitted when a new order is accepted.
message OrderPlacedEvent {
  string order_id = 1;
  string user_id = 2;
  int64 bot_id = 3;
  string stock_ticker = 4;
  types.OrderType order_type = 5;
  types.OrderSide side = 6;
  int64 quantity = 7;
  int64 limit_price_cents = 8;
}

// OrderCancelledEvent is emitted when an order is cancelled.
message OrderCancelledEvent {
  string order_id = 1;
  string user_id = 2;
  int64 bot_id = 3;
  int64 remaining_quantity = 4;
}

// OrderFilledEvent is emitted when an order is fully filled.
message OrderFilledEvent {
  string order_id = 1;
  string user_id = 2;
  int64 bot_id = 3;
  int64 total_quantity = 4;
  int64 average_fill_price_cents = 5;
}

// OrderPartiallyFilledEvent is emitted when an order is partially filled.
message OrderPartiallyFilledEvent {
  string order_id = 1;
  string user_id = 2;
  int64 bot_id = 3;
  int64 filled_quantity = 4;
  int64 remaining_quantity = 5;
  int64 fill_price_cents = 6;
}

// OrderRejectedEvent is emitted when an order is rejected.
message OrderRejectedEvent {
  string order_id = 1;
  string user_id = 2;
  int64 bot_id = 3;
  types.ErrorCode reason = 4;
  string error_message = 5;
}

// TradeExecutedEvent is emitted when a trade is executed.
message TradeExecutedEvent {
  string trade_id = 1;
  string stock_ticker = 2;
  string buyer_order_id = 3;
  string seller_order_id = 4;
  string buyer_user_id = 5;
  int64 buyer_bot_id = 6;
  string seller_user_id = 7;
  int64 seller_bot_id = 8;
  int64 quantity = 9;
  int64 price_cents = 10;
  int64 total_value_cents = 11;
}